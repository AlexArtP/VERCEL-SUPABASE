<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Flujo Integración Vercel + Firebase</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true, theme: 'default' });
  </script>
  <style>
    body { background: #f8fafc; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; }
    .container { max-width: 900px; margin: 40px auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 16px #0001; padding: 32px; }
    h1 { text-align: center; color: #2563eb; }
    .mermaid { margin-top: 32px; }
    @media (max-width: 600px) { .container { padding: 8px; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>Flujo de Integración Next.js (Vercel) + Firebase</h1>
    <div class="mermaid">
flowchart TD
    A[Usuario accede a la app en Vercel] --> B[Next.js renderiza página (SSR/SSG/API)]
    B --> C{¿Requiere datos protegidos?}
    C -- Sí --> D[Next.js consulta Firestore vía SDK cliente]
    D --> E{¿Usuario autenticado?}
    E -- Sí --> F[Firestore permite acceso según reglas]
    E -- No --> G[Firestore deniega acceso]
    C -- No --> H[Next.js muestra contenido público]
    F --> I[Datos mostrados en UI]
    G --> J[UI muestra error de permisos]
    H --> I
    I --> K{¿Acción de usuario?}
    K -- Login --> L[Next.js usa Firebase Auth SDK]
    L --> M[Usuario autenticado en Firebase]
    M --> D
    K -- Registro --> N[Next.js usa Firebase Auth SDK]
    N --> O[Usuario registrado en Firebase]
    O --> M
    K -- CRUD (citas, módulos, etc) --> P[Next.js llama API route (SSR) o Firestore directo]
    P --> D
    subgraph Vercel
      A
      B
      C
      H
      K
      L
      N
      P
    end
    subgraph Firebase
      D
      E
      F
      G
      M
      O
    end
    subgraph UI
      I
      J
    end
    </div>
    <p style="text-align:center;color:#64748b;margin-top:2em;">Generado automáticamente - <a href="https://mermaid.js.org/" target="_blank">Mermaid.js</a></p>
  </div>
</body>
</html>
